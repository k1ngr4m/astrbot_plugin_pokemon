# 变更日志 (Changelog)

## [0.0.9] - 2025-11-14

### ✨ 新功能 (Features)
- **背包道具ID显示**: 在背包命令返回中添加道具ID显示，格式为`[道具ID] 道具名称 x数量`
- **捕捉命令道具ID支持**: 捕捉命令现在支持使用道具ID进行捕捉，支持`/捕捉 [道具ID]`和`/捕捉`两种格式
- **捕捉详情增强**: 捕捉成功或失败的消息中显示使用的道具ID信息
- **冒险命令增强**: 冒险命令添加校验，如果用户已经遇到了野生宝可梦，则无法重新冒险
- **冒险冷却时间**: 冒险命令添加60秒冷却时间限制，防止频繁使用
- **用户冒险时间持久化**: 用户的最后冒险时间从内存字典迁移到数据库users表中存储，确保数据持久化
- **逃跑指令**: 新增`/逃跑`指令，用户可以选择逃离遇到的野生宝可梦，基础成功率为80%
- **逃跑提示**: 在冒险、战斗和捕捉指令中添加了关于逃跑选项的提示信息

### 🐛 修复 (Bug Fixes)
- 修复了JSON配置文件格式错误导致的插件加载失败问题

### 📝 其他变更
- 为users表新增last_adventure_time字段，用于存储用户最后冒险时间戳
- 扩展User数据模型，添加last_adventure_time字段
- 更新SqliteUserRepository，添加更新和获取用户最后冒险时间的方法
- 修改AreaHandlers，将冒险时间记录和检查逻辑从内存字典改为数据库操作
- 移除内存中的_last_adventure_time字典，实现数据持久化
- 创建RunHandlers处理逃跑指令，实现逃跑逻辑和成功率计算
- 优化数据库结构，添加迁移脚本以支持新字段
- 更新冒险提示信息，告知用户可以选择战斗、捕捉或逃跑
- 优化数据库查询和缓存机制，提升性能
- 修改ItemService中的format_items_list方法，为道具显示添加ID前缀
- 修改CatchHandlers中的catch_pokemon方法，解析消息中的道具ID参数并验证精灵球类型
- 增强用户错误提示，对无效道具ID或非精灵球类型的道具提供明确的错误信息
- 修改AreaHandlers中的adventure方法，添加野生宝可梦存在性检查和冷却时间控制
- 在PokemonPlugin中添加冒险冷却时间管理属性和最后冒险时间记录
- 新增配置文件_conf_schema.json，定义插件配置项（包括冒险冷却时间）

---

## [0.0.8] - 2025-11-14

### ✨ 新功能 (Features)
- **每日签到系统**: 实现完整的每日签到功能，用户每天可签到一次
- **背包系统**: 实现完整的背包系统，用户可以查看自己拥有的所有道具
- **道具查看**: 添加/背包指令，用户可以查看背包中所有道具
- **商店系统**: 添加完整的商店系统，支持商店浏览和商品购买功能
  - 实现商店数据模型（Shop, ShopItem）和相关仓储接口
  - 创建商店和商店商品数据库表结构
  - 实现商店服务层，支持商店信息查询和商品购买逻辑
  - 添加商店命令处理器，支持`/商店 [商店短码]`和`/商店购买 [商店短码] [物品ID] [数量]`指令

### 🐛 修复 (Bug Fixes)
- 修复领域模型导入路径问题
- 修复数据设置服务中的类型提示问题
- 修复商店仓储实现中的返回值类型问题
- 优化宝可梦列表显示，移除速度属性展示以简化界面

### 📝 其他变更
- 新增CheckinService服务类处理签到业务逻辑
- 扩展用户仓储接口和实现，支持签到相关数据操作
- 新增CheckinHandlers处理器处理签到指令
- 新增ItemService服务类处理道具业务逻辑
- 扩展用户仓储接口和实现，支持获取用户道具数据
- 新增ItemHandlers处理器处理道具指令
- 完善道具显示格式，提供更友好的用户体验
- 新增ShopService服务类处理商店业务逻辑
- 新增ShopHandlers处理器处理商店指令
- 新增商店相关仓储接口和SQLite实现
- 完善仓储接口定义，使用领域模型而非字典传递数据
- 优化服务层依赖注入，明确依赖关系
- 改进SQLite仓储实现，增强类型安全性和代码可读性
- 重构领域模型，将AdventureArea和AreaPokemon模型移至models.py文件
- 扩展数据库迁移文件，添加商店和商店商品表结构及索引
- 扩展初始数据配置，包含商店和商店商品初始数据
- 改进数据设置服务，支持商店数据初始化

---

## [0.0.7] - 2025-11-13

- **队伍验证**: 战斗系统会验证用户是否设置了有效队伍，只允许使用队伍中的宝可梦进行战斗
- **冒险验证**: 冒险系统会验证用户是否设置了有效队伍，确保只有设置了队伍的用户才能进行冒险
- **经验系统**: 实现基于n³公式的等级经验系统，宝可梦和用户都能获得经验值
- **升级系统**: 支持宝可梦和用户升级，显示升级提示和等级提升信息
- **战斗奖励**: 战斗胜利时获得经验值，失败时不获得经验值
- **经验值计算优化**: 宝可梦经验值改为 (基础经验50 × 野生宝可梦等级) ÷ 7
- **玩家经验调整**: 根据新规则，玩家不再获得经验值
- **队伍经验系统**: 战斗胜利时，队伍中的所有宝可梦都会获得经验值
- **经验显示优化**: 显示队伍中每个宝可梦获得的经验值和升级信息
- **属性增长系统**: 宝可梦升级时根据种族值、IV、EV重新计算属性值
- **升级属性计算**: 使用官方宝可梦公式计算升级后的属性值

### 🐛 修复 (Bug Fixes)
- 修复了战斗系统中队伍数据解析错误导致的KeyError问题

### 📝 其他变更
- 新增ExpService服务类处理经验系统和升级逻辑
- 实现基于n³公式的等级经验系统（1级1点经验，100级1,000,000点经验）
- 实现宝可梦和用户的经验值计算和升级机制

---

## [0.0.6] - 2025-11-12

### ✨ 新功能 (Features)
- **野生宝可梦属性生成**: 实现野生宝可梦完整属性值生成，包括HP、攻击、防御、特攻、特防、速度
- **IV值系统**: 野生宝可梦生成符合官方设定的0-31范围内的独立个体值(IV)
- **属性计算优化**: 使用正确的官方公式计算野生宝可梦属性值，确保游戏平衡性
- **冒险区域初始化**: 添加初始冒险区域"家门草"，包含所有草系宝可梦
- **用户提示统一管理**: 创建AnswerEnum枚举类，统一管理所有用户提示信息
- **宝可梦战斗系统**: 实现完整的宝可梦战斗系统，包含胜率计算算法
- **属性克制计算**: 实现18种宝可梦属性相互克制关系计算
- **战力评分模型**: 构建基于等级、攻防属性、属性克制、速度的战力评分模型
- **胜率换算算法**: 使用Sigmoid函数将战力差平滑映射到0-100%胜率区间
- **战斗指令**: 添加/战斗指令，用户可与遇到的野生宝可梦进行战斗
- **战斗结果展示**: 显示详细的战斗胜率分析和战斗结果

- 修复了POKEMON_TYPES_DATA中元组格式错误导致属性类型显示异常的问题
- 修复了数据库迁移结构，将属性值字段整合到初始表结构中
- 修复了未注册用户提示信息的重复代码问题
- 修复了pokemon_species_types表查询时使用不存在的pst.id字段的问题

### 📝 其他变更
- 删除冗余的数据库迁移文件003_add_pokemon_stats.py
- 重构数据初始化服务，支持冒险区域数据初始化
- 优化数据库索引结构，提升查询性能
- 新增BattleService服务类处理战斗相关业务逻辑
- 新增BattleHandlers处理器处理战斗指令
- 新增缓存机制存储用户遇到的野生宝可梦信息供战斗使用
- 优化战斗算法，采用更合理的等级修正和速度加成计算方式

---

## [0.0.5] - 2025-11-12

### ✨ 新功能 (Features)
- **冒险区域系统**: 实现完整的冒险区域功能，支持区域探索和野生宝可梦遭遇
- **区域短码系统**: 引入A开头的三位数区域短码（如A001）
- **查看区域指令**: 添加/查看区域指令，展示所有可冒险的区域
- **冒险指令**: 添加/冒险 <区域短码>指令，进入指定区域进行冒险
- **属性计算增强**: 使用官方宝可梦公式计算所有属性值（HP、攻击、防御、特攻、特防、速度）
- **实际属性存储**: 数据库中存储计算后的实际属性值，提高查询性能
- **宝可梦详情优化**: 完善宝可梦详细信息显示，包含所有实际属性值

### 🐛 修复 (Bug Fixes)
- 修复了队伍查看时的KeyError问题
- 修复了宝可梦属性计算逻辑

### 📝 其他变更
- 重构处理程序，分离PokemonHandlers以提高代码组织性
- 添加区域相关服务、仓储和领域模型
- 更新数据库迁移文件，包含冒险区域表结构
- 更新抽象仓储接口，添加区域相关接口

---

## [0.0.4] - 2025-11-11

### ✨ 新功能 (Features)
- **增强队伍系统**: 实现了完整的队伍系统，支持最多6只宝可梦，第一个为出战宝可梦
- **短码ID系统**: 引入短码ID系统（P0001-P9999格式），替代原来的数字ID显示
- **队伍设置命令**: 更新了队伍设置命令为"设置队伍"，支持多宝可梦设置
- **初始宝可梦完善**: 完善初始宝可梦创建逻辑，根据种族模板完善个体值、努力值等特性

### 🐛 修复 (Bug Fixes)
- 修复了数据库迁移结构，将短码字段添加到初始表结构中
- 修复了类型注释相关的问题

### 📝 其他变更
- 优化数据库结构，添加了大量索引以提高查询性能
- 改进了用户界面显示，使用更友好的短码ID
- 重构了相关服务和处理器以支持新功能
- 更新了注册流程提示信息，提供更清晰的指引

---

## [0.0.3] - 2025-11-11

### ✨ 新功能 (Features)
- **队伍系统**: 实现了完整的队伍系统功能，允许用户设置和管理出战宝可梦
- **队伍设置**: 添加了 `队伍设置 <宝可梦ID>` 指令，用户可以设置出战宝可梦
- **查看队伍**: 添加了 `查看队伍` 指令，显示当前队伍配置信息
- **数据仓储**: 新增了队伍数据仓储接口和SQLite实现
- **服务层重构**: 创建独立的TeamService处理队伍相关业务逻辑

### 🐛 修复 (Bug Fixes)
- 修复了一些数据访问和类型相关的问题

### 📝 其他变更
- 重构用户仓库和相关服务，优化初始宝可梦选择和队伍设置
- 完善注册流程提示信息，引导用户进行初始选择
- 添加了 .gitignore 文件，忽略缓存和临时文件

---

## [v0.0.2] - 2025-11-11

### ✨ 新功能 (Features)
- **队伍设置**: 添加了队伍设置功能，支持用户配置出战宝可梦
- **用户服务**: 扩展了用户服务，支持队伍配置相关操作

---

## [v0.0.1] - 2025-11-11

### ✨ 新功能 (Features)
- **初始选择**: 添加初始宝可梦选择功能，用户可以从妙蛙种子、小火龙、杰尼龟中选择
- **数据初始化**: 初始化游戏数据，包括宝可梦和物品模板
- **数据库**: 初始化SQLite数据库，设置数据表结构
- **注册系统**: 添加用户注册功能，新用户可以获得初始金币

### 🚀 初始版本
- 创建宝可梦游戏插件的基础架构
- 实现用户管理系统
- 实现宝可梦捕捉和查看功能
- 实现基础的宝可梦战斗相关功能